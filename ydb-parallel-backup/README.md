# Скрипты для параллельного бэкапа в YDB
Скрипты позволяют создавать бэкап в несколько потоков. Заложена следующая логика:
- Выгружаем схему
- Составляем список таблиц, сортируем по размеру
- Делаем снэпшот таблиц (`ydb tools copy`)
- Делаем дамп таблиц (`ydb tools dump`) в указанном количестве потоков (по умолчанию: 1)
- Делаем дамп представлений

Ограничения:
- В бэкап не попадают топики.
- Бэкап не работает для колоночных таблиц.
- Бэкап только в файловую систему.

Также реализована логика для восстановления из созданного бэкапа:
- Сначала восстанавливаются таблицы в указанном количестве потоков (по умолчанию: 1)
- Дальше восстанавливаются представления
- База данных для восстановления не должна содержать восстанавливаемых таблиц (иначе будет ошибка).

## Использование
- Скопировать скрипты:
    ```shell
    git clone https://github.com/AlexeyBest/ydb-helpers/
    cd ydb-helpers/ydb-parallel-backup/
    ```
- Создайте профиль в базе, для которой будете делать бэкап. Справка: [Создание профиля в YDB CLI](https://ydb.tech/docs/ru/reference/ydb-cli/profile/create) 
- Создайте профиль для базы, в которую будет восстанавливаться.
- Укажите все настройки в файле configuration.conf
- Дайте права для исполнения файлов backup.sh, restore.sh (
    ```shell
    chmod +x backup.sh
    chmod +x restore.sh
    ```
- Выполните бэкап 
    ```shell
    ./backup.sh
    ```
- Если бэкап выполнился успешно, то скопируйте путь для директории с бэкапом. 
- Восстановление выполняется командой 
    ```shell
    ./restore.sh {директория_с_бэкапом}
    ```